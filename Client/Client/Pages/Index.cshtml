@page
@model IndexModel
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery
@using Microsoft.Extensions.Configuration
@inject IConfiguration config
@{

    var requestToken = Antiforgery.GetAndStoreTokens(HttpContext).RequestToken;
    string baseAdress = config.GetSection("BaseAddress").Value;
}
<input id="RequestVerificationToken" type="hidden" value="@requestToken" />

<script defer src="https://unpkg.com/alpinejs@3.10.3/dist/cdn.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
    [x-cloak] {
        display: none;
    }
</style>

<head>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="true">
</head>

<div x-data="{ categories: [], recipes: [], expandCategory: false, expandRecipe: false, logged: '' , logScreen:true}" x-effect="categories = await listCategories(logged);recipes = await listRecipes(logged);" x-cloak x-transition>


    <div x-show="logScreen" x-data="{ expandLogin:true , expandRegister:false }" style="overflow:hidden;" x-cloak x-transition>

        <!--Log in-->

        <div x-data="{ user: { username:'' , password: '' } }" x-show="expandLogin" style="margin-top:200px" x-cloak x-transition>
            <div class="align-content-center col-6 w-25" style="margin:auto;text-align:center;color:#1A2238;">
                <div class="form-floating form-outline mb-4">
                    <input x-model="user.username" class="form-control" />
                    <label class="form-label" for="floatingInput">Username</label>
                </div>
                <div class="form-floating form-outline mb-4">
                    <input x-model="user.password" type="password" class="form-control" />
                    <label class="form-label">Password</label>
                </div>
                <button x-on:click="logged=await login(user);logScreen=!logged;fire(logged,'Logged in successfully')" class="btn btn-success"><i class="bi bi-door-open-fill"> Sign in</i></button>
                <script>
                    let refreshToken;
                    function fire(logged, msg) {
                        if (logged) {
                            Swal.fire({
                                icon: 'success',
                                title: msg,
                                showConfirmButton: false,
                                timer: 1500
                            })
                        }
                        else if (logged === false) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Invalid data',
                                showConfirmButton: false,
                                timer: 1500
                            })
                        }
                        else {

                        }
                    }
                    async function login(user) {
                        let url = '@baseAdress' + 'login/' + JSON.stringify(user);
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                RequestVerificationToken:
                                    document.getElementById("RequestVerificationToken").value
                            },
                            body: JSON.stringify({
                                user: user
                            })
                        })
                            .then(res => { return res })
                        if (response.ok) {
                            refreshToken = response.headers.get('refreshToken');
                            setInterval(getNewToken('f27298ab-bf49-4c0e-b21a-31f8e11eb10c', refreshToken), 120000);
                            return response.text();
                        }
                        else
                            return false;
                    }
                </script>
                <br /><br />
                <div class="text-center">
                    <p style="color:#66FCF1">Not a member? <a x-on:click="expandLogin=false;expandRegister=true;" class="btn btn-outline-primary">Register</a></p>
                </div>
            </div>
        </div>

        <!--Register-->

        <div x-data="{ newUser : { username:'' , password:'' , repeatedPassword :'' } , created:null }" x-show="expandRegister" style="margin-top:200px" x-cloak x-transition>
            <form method="post" class="align-content-center col-6 w-25 needs-validation" style="margin:auto;text-align:center;color:#1A2238;" novalidate>
                <div class="form-floating form-outline mb-4">
                    <input x-model="newUser.username" class="form-control" required />
                    <label class="form-label">Username</label>
                    <div class="valid-feedback" style="font-size:large">
                        Looks good!
                    </div>
                    <div class="invalid-feedback" style="font-size:large">
                        Cant be empty.
                    </div>
                </div>
                <div class="form-floating form-outline mb-4">
                    <input x-model="newUser.password" type="password" class="form-control" required />
                    <label class="form-label">Password</label>
                    <div class="valid-feedback" style="font-size:large">
                        Looks good!
                    </div>
                    <div class="invalid-feedback" style="font-size:large">
                        Cant be empty.
                    </div>
                </div>
                <div class="form-floating form-outline mb-4">
                    <input x-model="newUser.repeatedPassword" type="password" class="form-control" required />
                    <label class="form-label">Repeat password</label>
                    <div class="valid-feedback" style="font-size:large">
                        Looks good!
                    </div>
                    <div class="invalid-feedback" style="font-size:large">
                        Cant be empty.
                    </div>
                </div>
                <button x-on:click="created=await register(newUser);fire(created,'Created successfully');expandRegister=!created;expandRegister=!created;expandLogin=!expandRegister" type="button" class="btn btn-success btn-block mb-3 isWorking"><i class="bi bi-patch-plus"> Sign up</i></button>
                <script>
                    async function register(newUser) {
                        let url = '@baseAdress' + 'create-user/' + JSON.stringify(newUser);
                        if (newUser.password != newUser.repeatedPassword) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Passwords dont match',
                                showConfirmButton: false,
                                timer: 1500
                            })
                        }
                        else {
                            const response = await fetch(url, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    RequestVerificationToken:
                                        document.getElementById("RequestVerificationToken").value
                                },
                                body: JSON.stringify({
                                    newUser: newUser
                                })
                            })
                                .then(res => { return res })
                            if (response.ok)
                                return true;
                            else
                                return false;
                        }
                    }
                </script>
                <div class="text-center">
                    <p style="color:#66FCF1">Already have an account? <a x-on:click="expandLogin=true;expandRegister=false;" class="btn btn-outline-primary">Sign in</a></p>
                </div>
            </form>
        </div>
    </div>

    <div x-show="logged" style="overflow-y:auto;overflow-x:hidden" x-cloak x-transition>

        <!--Nav Bar-->

        <header>
            <nav class="navbar navbar-expand-lg" style="height:60px;">
                <div class="container-fluid">
                    <div class="collapse navbar-collapse" id="navbarColor03">
                        <ul class="navbar-nav me-auto">
                            <li style="margin-left:675px;margin-top:30px;">
                                <div class="logo-holder logo-5">
                                    <a class="nav-link text-light" asp-page="/Home">
                                        <h3>Yum</h3>
                                        <p>City</p>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>

        <!--Home-->

        <div class="row row-cols-1 row-cols-md-2 g-2 text-center">
            <div class="col" style="width:400px;height:500px;margin-left:200px;margin-top:25px;border-style:groove;border-color:#66FCF1">
                <div id="carouselExampleSlidesOnly" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="~/Pictures/Food1.jpg" class="d-block w-100" style="height:350px;">
                        </div>
                        <div class="carousel-item">
                            <img src="~/Pictures/Food2.jpg" class="d-block w-100" style="height:350px;">
                        </div>
                        <div class="carousel-item">
                            <img src="~/Pictures/Food3.jpg" class="d-block w-100" style="height:350px;">
                        </div>
                    </div>
                </div>
                <div>
                    <h4 style="color:#C5C6C7;text-align:center;margin-top:15px;font-family:'Square Peg',cursive;">cook what you love</h4>
                    <button x-on:click="recipes = await listRecipes(logged);expandRecipe= !expandRecipe;expandCategory=false" style="background-color:#1F2833;color:#C5C6C7;margin-top:25px;" class="btn">Recipes</button>
                    <script>
                        async function listRecipes(token) {
                            let url = '@baseAdress' + 'list-recipes/';
                            const response = await fetch(url, {
                                method: 'GET',
                                headers: {
                                    'Content-Type': 'application/json',
                                    RequestVerificationToken:
                                        document.getElementById("RequestVerificationToken").value,
                                    'Authorization': 'Bearer ' + token
                                }
                            })
                                .then(res => { return res })
                            if (response.ok)
                                return response.json();
                        }
                    </script>
                </div>
            </div>
            <div class="col" style="width:400px;height:500px;margin-left:300px;margin-top:25px;border-style:groove;border-color:#66FCF1">
                <div id="carouselExampleSlidesOnly" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="~/Pictures/Cat1.jpg" class="d-block w-100" style="height:350px;">
                        </div>
                        <div class="carousel-item">
                            <img src="~/Pictures/Cat2.jpg" class="d-block w-100" style="height:350px;">
                        </div>
                        <div class="carousel-item">
                            <img src="~/Pictures/Cat3.jpg" class="d-block w-100" style="height:350px;">
                        </div>
                    </div>
                </div>
                <h4 style="color:#C5C6C7;text-align:center;margin-top:15px;font-family:'Square Peg',cursive;">discover different cultures</h4>
                <button x-on:click="categories = await listCategories(logged);expandCategory= !expandCategory;expandRecipe=false" style="background-color:#1F2833;color:#C5C6C7;margin-top:25px" class="btn">Categories</button>
                <script>
                    async function listCategories(token) {
                        let url = '@baseAdress' + 'list-categories';
                        const response = await fetch(url, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                RequestVerificationToken:
                                    document.getElementById("RequestVerificationToken").value,
                                'Authorization': 'Bearer ' + token
                            }
                        })
                            .then(res => { return res })
                        if (response.ok)
                            return response.json();
                    }
                </script>
            </div>
        </div>

        <!--List Categories-->

        <div x-data="{ expandCreate:false, chosenCategory:'', expandDelete:false, expandEdit:false,position:-1,deleted:null,newCategory:'' }" x-show="expandCategory" x-cloak x-transition>
            <div class="row row-cols-1 row-cols-md-3 g-2 text-center">
                <template x-for="(category, index) in categories">
                    <div>
                        <div class="col">
                            <div class="card h-100 text-center" style="border:groove;border-color:#66FCF1;background-color:transparent;margin-left:2px;margin-top:5px;">
                                <div class="card-body">
                                    <h5 x-text="category" class="card-title" style="color:white"></h5>
                                    <a x-on:click="chosenCategory= category ;position=index+1;expandEdit= !expandEdit;expandDelete=false;expandCreate=false" class="btn btn-dark" style="background-color:#1F2833;color:#C5C6C7;margin-top:10px;"><i class="bi bi-pencil-square" style="font-style:normal"> Edit</i></a>
                                    <a x-on:click="chosenCategory= category ;" class="btn btn-danger" style="color:white;margin-top:10px;" data-bs-toggle="modal" data-bs-target="#deleteCategoryModal"><i class="bi bi-trash" style="font-style:normal"> Delete</i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <!--Create Category-->

            <button x-data="{created :false}" x-on:click="expandCreate = ! expandCreate;expandEdit=false;expandDelete=false;newCategory=''" style="background-color:#252f3e;color:white;margin-top:50px;margin-left:45%" class="btn text-center"><i class="bi bi-plus-circle" style="font-style:normal"> Create Category</i></button>

            <div x-show="expandCreate" x-cloak x-transition>
                <form class="align-content-center col-6 needs-validation" style="margin:auto;text-align:center;margin-top:50px;color:#1A2238" novalidate>
                    <input x-model="newCategory" placeholder="Enter category name" type="text" required />
                    <div class="valid-feedback" style="font-size:large">
                        Looks good!
                    </div>
                    <div class="invalid-feedback" style="font-size:large">
                        Cant be empty.
                    </div>
                    <button type="button" x-on:click="created=await createCategory(newCategory,logged);expandCreate= !created;fire(created,'Created successfully');newCategory='';categories=await listCategories(logged);" class="btn btn-success text-center isWorking" style="font-style:normal"> Add</button>
                </form>
                <script>
                    async function createCategory(category, token) {
                        let url = '@baseAdress' + 'add-category/' + category;
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                RequestVerificationToken:
                                    document.getElementById("RequestVerificationToken").value,
                                'Authorization': 'Bearer ' + token
                            },
                            body: JSON.stringify({
                                category: category
                            })
                        })
                            .then(res => { return res })
                        if (response.ok)
                            return true;
                        else
                            return false;
                    }
                </script>
            </div>

            <!--Delete Category-->

            <div class="modal fade" id="deleteCategoryModal" tabindex="-1" aria-labelledby="deleteCategoryModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" style="text-align:center">
                            Are you sure?
                            <br />
                            You won't be able to revert this!
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button x-on:click="deleted=await deleteCategory(chosenCategory,logged);expandEdit=false;expandCreate=false;fire(deleted,'Deleted Successfully');categories = await listCategories(logged)" type="button" class="btn btn-primary" style="margin-right:125px" data-bs-dismiss="modal">Yes, delete it!</button>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                async function deleteCategory(category, token) {
                    let url = '@baseAdress' + 'delete-category/' + category;
                    const response = await fetch(url, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                            RequestVerificationToken:
                                document.getElementById("RequestVerificationToken").value,
                            'Authorization': 'Bearer ' + token
                        },
                        body: JSON.stringify({
                            category: category
                        })
                    })
                        .then(res => { return res })
                    if (response.ok)
                        return true;
                    else
                        return false;
                }
            </script>

            <!--Edit Category-->

            <div x-show="expandEdit" x-cloak x-transition>
                <form method="post" class="align-content-center col-6 needs-validation" style="margin:auto;text-align:center;margin-top:50px;color:#1A2238" novalidate>
                    <input x-model="chosenCategory" type="text" required />
                    <div class="valid-feedback" style="font-size:large">
                        Looks good!
                    </div>
                    <div class="invalid-feedback" style="font-size:large">
                        Cant be empty.
                    </div>
                    <button x-on:click="await editCategory(position,chosenCategory,logged);expandEdit= fasle;expandCategory= false" class="btn btn-success isWorking" style="font-style:normal"> Edit</button>
                </form>
                <script>
                    async function editCategory(position, newCategory, token) {
                        let url = '@baseAdress' + 'update-category/' + position + "/" + newCategory;
                        const response = await fetch(url, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                RequestVerificationToken:
                                    document.getElementById("RequestVerificationToken").value,
                                'Authorization': 'Bearer ' + token
                            },
                            body: JSON.stringify({
                                newCategory: newCategory
                            })
                        })
                            .then(res => { return res })
                        if (response.ok)
                            return true;
                        else
                            return false;
                    }
                </script>
            </div>

        </div>

        <!--List Recipes-->

        <div x-data="{ expandCreate:false, chosenRecipe:{Title:'', Ingredients:[], Instructions:[], Categories:[]}, expandDelete:false, expandEdit:false, ing:'' , ins:'',editIngredients:'' , editInstructions:'',deleteId:'' }" x-show="expandRecipe" x-cloak x-transition>
            <div class="row row-cols-1 row-cols-md-4 g-2 text-center">
                <template x-for="recipe in recipes">
                    <div class="col">
                        <div class="card h-100 text-center" style="background-color:transparent;margin-left:2px;margin-top:5px;margin-right:50px;border:groove;border-color:#66FCF1;">
                            <div class="card-body">
                                <h5 x-text="recipe.title" class="card-title" style="color:white"></h5>
                                <div x-data="{ expanded: false }">
                                    <button x-on:click="expanded = ! expanded" style="background-color:#45A29E;color:black;margin-top:10px;font-style:normal" class="text-center"><i class="bi bi-search" style="font-style:normal"> Show Ingredients</i></button>
                                    <template x-for="ing in recipe.ingredients">
                                        <p x-text="'- '+ing" x-show="expanded" x-collapse class="card-text text-start" x-transition style="color:white"></p>
                                    </template>
                                </div>
                                <br>
                                <div x-data="{ expanded: false }">
                                    <button x-on:click="expanded = ! expanded" style="background-color:#45A29E;color:black;margin-top:10px;font-style:normal" class="text-center"><i class="bi bi-search" style="font-style:normal"> Show Instructions</i></button>
                                    <template x-for="ins in recipe.instructions">
                                        <p x-text="'- '+ins" x-show="expanded" x-collapse class="card-text text-start" x-transition style="color:white"></p>
                                    </template>
                                </div>
                                <br>
                                <div x-data="{ expanded: false }">
                                    <button x-on:click="expanded = ! expanded" style="background-color:#45A29E;color:black;margin-top:10px;font-style:normal" class="text-center"><i class="bi bi-search" style="font-style:normal"> Show Categories</i></button>
                                    <template x-for="cat in recipe.categories">
                                        <p x-text="'- '+cat" x-show="expanded" x-collapse class="card-text text-start" x-transition style="color:white"></p>
                                    </template>
                                </div>
                                <br>
                                <a x-on:click="chosenRecipe.title=recipe.title;chosenRecipe.id=recipe.id;chosenRecipe.ingredients=recipe.ingredients;chosenRecipe.instructions=recipe.instructions;chosenRecipe.categories=recipe.categories;[chosenRecipe,editIngredients,editInstructions]=adjustEdit(chosenRecipe,editIngredients,editInstructions);expandEdit= !expandEdit;expandDelete=false;expandCreate=false;toast(expandEdit);categories = await listCategories(logged)" class="btn btn-dark" style="background-color:#1F2833;color:#C5C6C7;margin-top:10px;font-style:normal"><i class="bi bi-pencil-square" style="font-style:normal"> Edit</i></a>
                                <a x-on:click="deleteId=recipe.id" class="btn btn-danger" style="color:white;margin-top:10px;font-style:normal" data-bs-toggle="modal" data-bs-target="#deleteRecipeModal"><i class="bi bi-trash" style="font-style:normal"> Delete</i></a>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
            <button x-on:click="expandCreate = ! expandCreate;expandDelete=false;expandEdit=false;categories = await listCategories(logged);[chosenRecipe,ing,ins]=clear(chosenRecipe,ing,ins)" style="background-color:#252f3e;color:white;margin-top:50px;margin-left:45%" class="btn text-center"><i class="bi bi-plus-circle" style="font-style:normal"> Create Recipe</i></button>

            <!--Create Recipe-->

            <div x-show="expandCreate" x-cloak x-transition x-data="{created:false}">
                <form method="post" class="align-content-center col-6 needs-validation" style="margin:auto;text-align:center;margin-top:50px;color:#66FCF1" novalidate>
                    <div>
                        <div class="row mt-4 col-11 m-auto">
                            <label style="text-align:left">Recipe Title</label>
                            <input class="form-control" x-model="chosenRecipe.Title" required>
                            <div class="valid-feedback" style="font-size:large">
                                Looks good!
                            </div>
                            <div class="invalid-feedback" style="font-size:large">
                                Cant be empty.
                            </div>
                        </div>
                        <div class="row mt-4 col-11 m-auto">
                            <label style="text-align:left">Ingredients</label>
                            <textarea class="form-control resize" x-model="ing" placeholder="After every ingredient press enter for new line." rows="5" cols="30" required></textarea>
                            <div class="valid-feedback" style="font-size:large">
                                Looks good!
                            </div>
                            <div class="invalid-feedback" style="font-size:large">
                                Cant be empty.
                            </div>
                        </div>
                        <div class="row mt-4 col-11 m-auto">
                            <label style="text-align:left">Instructions</label>
                            <textarea class="form-control resize" x-model="ins" placeholder="After every instructions press enter for new line." rows="5" cols="30" required></textarea>
                            <div class="valid-feedback" style="font-size:large">
                                Looks good!
                            </div>
                            <div class="invalid-feedback" style="font-size:large">
                                Cant be empty.
                            </div>
                        </div>
                        <div class="row mt-4 col-11 m-auto">
                            <form method="post">
                                <label style="text-align:left">Choose one or more category</label>
                                <br>
                                <select class="form-control" x-model="chosenRecipe.Categories" multiple style="color:black" required>
                                    <template x-for="cat in categories">
                                        <option x-model="cat" value="cat" x-text="cat"></option>
                                    </template>
                                </select>
                                <div class="valid-feedback" style="font-size:large">
                                    Looks good!
                                </div>
                                <div class="invalid-feedback" style="font-size:large">
                                    Cant be empty.
                                </div>
                                <p style="font-weight:bold">Hold down the Ctrl (windows) or Command (Mac) button to select multiple options.</p>
                            </form>
                        </div>
                        <button x-on:click="chosenRecipe= adjustRecipe(chosenRecipe,ing,ins);created=await createRecipe(chosenRecipe,logged);recipes = await listRecipes(logged);fire(created,'Created successfully');expandCreate=!created;" type="button" class="btn btn-success isWorking"><i class="bi bi-plus-circle-fill" style="font-style:normal"> Create Recipe</i></button>
                        <br><br>
                    </div>
                </form>

                <script>
                    async function createRecipe(recipe, token) {
                        let url = '@baseAdress' + 'add-recipe/' + JSON.stringify(recipe);
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                RequestVerificationToken:
                                    document.getElementById("RequestVerificationToken").value,
                                'Authorization': 'Bearer ' + token
                            },
                            body: JSON.stringify({
                                jsonRecipe: recipe
                            })
                        })
                            .then(res => { return res })
                        if (response.ok)
                            return true;
                        else
                            return false;
                    }
                    function adjustRecipe(chosenRecipe, ing, ins) {
                        ing = ing.trim();
                        ins = ins.trim();
                        ing = ing.replaceAll('/', '-');
                        ins = ins.replaceAll('/', '-');
                        chosenRecipe.Ingredients = ing.split('\n');
                        chosenRecipe.Instructions = ins.split('\n');
                        return chosenRecipe;
                    }
                    function clear(chosenRecipe, ing, ins) {
                        ing = '';
                        ins = '';
                        chosenRecipe.Title = '';
                        chosenRecipe.Categories = [];
                        chosenRecipe.ingredients = [];
                        chosenRecipe.Instructions = [];
                        return [chosenRecipe, ing, ins];
                    }
                </script>

            </div>

            <!--Delete Recipe-->

            <div class="modal fade" id="deleteRecipeModal" tabindex="-1" aria-labelledby="deleteRecipeModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" style="text-align:center">
                            Are you sure?
                            <br />
                            You won't be able to revert this!
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button x-on:click="deleted=await deleteRecipe(deleteId,logged);expandEdit=false;expandCreate=false;fire(deleted,'Deleted Successfully');recipes = await listRecipes(logged)" type="button" class="btn btn-primary" style="margin-right:125px" data-bs-dismiss="modal">Yes, delete it!</button>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                async function deleteRecipe(id, token) {
                    let url = '@baseAdress' + 'delete-recipe/' + id;
                    const response = await fetch(url, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                            RequestVerificationToken:
                                document.getElementById("RequestVerificationToken").value,
                            'Authorization': 'Bearer ' + token
                        },
                        body: {
                            id: id
                        }
                    })
                        .then(res => { return res })
                    if (response.ok)
                        return true;
                    else
                        return false;
                }
            </script>

            <!--Update Recipe-->
            <!--Note to User-->

            <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
                <div id="liveToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true" style="background-color:#66FCF1">
                    <div class="toast-header">
                        <strong class="me-auto">Yum City</strong>
                        <small>Just Now!</small>
                        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body" style="background-color:#1F2833">
                        Hello, Chief! separate between ingredients / instructions with a new line
                    </div>
                </div>
                <script>
                    var options = {
                        animation: true,
                        delay: 5000
                    };
                    function toast(flag) {
                        if (flag) {
                            let element = document.getElementById("liveToast");
                            let toastElement = new bootstrap.Toast(element, options);
                            toastElement.show();
                        }
                    }
                </script>
            </div>

            <div x-show="expandEdit" x-cloak x-transition x-data="{ edited:false }">
                <form method="post" class="align-content-center col-6 needs-validation validate" style="margin:auto;text-align:center;margin-top:50px;color:#66FCF1" novalidate>
                    <input x-model="chosenRecipe.id" hidden>
                    <div>
                        <div class="row mt-4 col-11 m-auto">
                            <label style="text-align:left">Recipe Title</label>
                            <input x-model="chosenRecipe.title" class="form-control" required>
                            <div class="valid-feedback" style="font-size:large">
                                Looks good!
                            </div>
                            <div class="invalid-feedback" style="font-size:large">
                                Cant be empty.
                            </div>
                        </div>
                        <div class="row mt-4 col-11 m-auto">
                            <label style="text-align:left">Ingredients</label>
                            <textarea class="form-control resize" x-model="editIngredients" placeholder="separate between ingredients with a ," rows="5" cols="30" required></textarea>
                            <div class="valid-feedback" style="font-size:large">
                                Looks good!
                            </div>
                            <div class="invalid-feedback" style="font-size:large">
                                Cant be empty.
                            </div>
                        </div>
                        <div class="row mt-4 col-11 m-auto">
                            <label style="text-align:left">Instructions</label>
                            <textarea class="form-control resize" x-model="editInstructions" placeholder="separate between instructions with a ," rows="5" cols="30" required></textarea>
                            <div class="valid-feedback" style="font-size:large">
                                Looks good!
                            </div>
                            <div class="invalid-feedback" style="font-size:large">
                                Cant be empty.
                            </div>
                        </div>
                        <div class="row mt-4 col-11 m-auto">
                            <form method="post">
                                <label style="font:bolder;text-align:left" class="fw-bold">Choose one or more category</label>
                                <br>
                                <select class="form-control" x-model="chosenRecipe.categories" multiple style="color:black" required>
                                    <template x-for="cat in categories">
                                        <option x-model="cat" value="cat" x-text="cat"></option>
                                    </template>
                                </select>
                                <p style="font-weight:bolder">Hold down the Ctrl (windows) or Command (Mac) button to select multiple options.</p>
                                <div class="valid-feedback" style="font-size:large">
                                    Looks good!
                                </div>
                                <div class="invalid-feedback" style="font-size:large">
                                    Cant be empty.
                                </div>
                            </form>
                        </div>
                        <br>
                        <button x-on:click="chosenRecipe=adjust(chosenRecipe,editIngredients,editInstructions);edited=await updateRecipe(chosenRecipe,chosenRecipe.id,logged);expandEdit= !edited;recipes=await listRecipes(logged);fire(edited,'Edited successfully')" type="button" class="btn btn-success isWorking" style="font-style:normal"> Edit</button>
                    </div>
                </form>
                <script>
                    async function updateRecipe(jsonRecipe, id, token) {
                        let url = '@baseAdress' + 'update-recipe/' + JSON.stringify(jsonRecipe) + "/" + id;
                        const response = await fetch(url, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                RequestVerificationToken:
                                    document.getElementById("RequestVerificationToken").value,
                                'Authorization': 'Bearer ' + token
                            },
                            body: JSON.stringify({
                                jsonRecipe: jsonRecipe
                            })
                        })
                            .then(res => { return res })
                        if (response.ok)
                            return true;
                        else
                            return false;
                    }
                    function adjust(chosenRecipe, editIng, editIns) {
                        editIng = editIng.trim();
                        editIns = editIns.trim();
                        let ing = editIng;
                        let ins = editIns;
                        chosenRecipe.Id = chosenRecipe.id;
                        chosenRecipe.Ingredients = ing.split('\n');
                        chosenRecipe.Instructions = ins.split('\n');
                        chosenRecipe.Title = chosenRecipe.title;
                        chosenRecipe.Categories = chosenRecipe.categories;
                        chosenRecipe.ingredients = ing.split('\n');
                        chosenRecipe.instructions = ins.split('\n');
                        return chosenRecipe;
                    }
                    function adjustEdit(recipe, ing, ins) {
                        let i;
                        ing = '';
                        ins = '';
                        for (i = 0; i < recipe.ingredients.length; i++) {
                            recipe.ingredients[i] = recipe.ingredients[i].replaceAll('\n', '');
                        }
                        for (i = 0; i < recipe.instructions.length; i++) {
                            recipe.instructions[i] = recipe.instructions[i].replaceAll('\n', '');
                        }
                        for (i = 0; i < recipe.ingredients.length; i++) {
                            ing = ing + recipe.ingredients[i] + '\n';
                        }
                        for (i = 0; i < recipe.instructions.length; i++) {
                            ins = ins + recipe.instructions[i] + '\n';
                        }
                        for (i = 0; i < recipe.ingredients.length; i++) {
                            recipe.ingredients[i] = recipe.ingredients[i] + '\n';
                        }
                        for (i = 0; i < recipe.instructions.length; i++) {
                            recipe.instructions[i] = recipe.instructions[i] + '\n';
                        }
                        return [recipe, ing, ins];
                    }
                </script>
            </div>
        </div>
    </div>
</div>
<script>
    async function getNewToken(id, rT) {
        let url = '@baseAdress' + 'refresh-token/' + id + '/' + JSON.stringify(rT);
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                RequestVerificationToken:
                    document.getElementById("RequestVerificationToken").value
            },
            body: JSON.stringify({
                id: id,
            })
        })
            .then(res => { return res })
        if (response.ok)
            return response.text();
        else
            return false;
    }
</script>